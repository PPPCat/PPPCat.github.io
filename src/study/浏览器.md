# 浏览器

### 浏览器跨域

#### 什么是跨域？

**跨域**是指：浏览器出于安全考虑，执行**同源策略**，阻止一个网页去请求不同源（协议+域名+端口）的数据访问和交互，防止程序恶意调用

```
前端页面地址：http://example.com/index.html  
请求的接口地址：http://api.example.com/data
```

因为域名不同，**这是跨域请求**



#### 常见跨域解决方案

| 方法                 | 说明                                                        |
| -------------------- | ----------------------------------------------------------- |
| **CORS（主流）**     | 后端设置响应头：`Access-Control-Allow-Origin: *` 或指定域名 |
| JSONP（仅GET）       | 利用 `<script>` 标签不受同源策略限制                        |
| 代理转发             | 由前端开发服务器（如 Vite、Webpack DevServer）代理接口      |
| Nginx 转发           | 配置 Nginx 进行反向代理请求                                 |
| iframe + postMessage | 利用 iframe 通信规避跨域                                    |



#### 示例：CORS 响应头（后端）

CORS是一个W3C标准，全称为**跨域资源共享**，使浏览器向跨源服务器发出xhr请求

- 服务器：需要实现CORS接口，即可实现跨源通信
- 浏览器：需要在请求头上添加一些头信息

一个跨域请求可能触发额外options请求，一依据是否触发options请求，将跨域请求分为[简单请求](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Guides/CORS)和非简单请求

```http
Access-Control-Allow-Origin: http://your-frontend.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorizatio n
```





### 浏览器缓存

浏览器缓存是提升网页加载速度、减少服务器负载的关键机制。缓存可解释为浏览器和业务侧根据不同的报文字段做出的笔筒的缓存动作而已

#### 两种缓存类型

| 缓存类型                            | 是否需要再次向服务器请求？         | 特点                                              |
| ----------------------------------- | ---------------------------------- | ------------------------------------------------- |
| **强缓存/本地缓存**（优先级高）     | ❌ 不请求服务器，直接用缓存         | 响应头中有 `Expires` 或 `Cache-Control`           |
| **弱缓存/协商缓存**（强缓存失效时） | ✅ 请求服务器，由服务器判断是否修改 | 请求头中带 `If-Modified-Since` 或 `If-None-Match` |



#### 强缓存相关响应头

```h
Cache-Control: max-age=3600         # 缓存 1 小时，在有效期内重复请求则无需再次访问服务器，直接从浏览器获取结果
Expires: Wed, 21 Oct 2025 07:28:00 GMT  # 绝对时间
```

#### 协商缓存相关响应头

```http
ETag: "abc123"                          # 服务器返回文件的标识符
Last-Modified: Wed, 21 Jul 2025 07:28:00 GMT
```

对应的请求头

```http
If-None-Match: "abc123"
If-Modified-Since: Wed, 21 Jul 2025 07:28:00 GMT
```

如果资源没变，服务器返回 **304 Not Modified**，浏览器使用本地缓存



#### 示例流程

1. 浏览器第一次请求资源，服务器返回资源 + 缓存头（如 `Cache-Control`）
2. 下次访问时，浏览器先检查是否在有效期内（强缓存），有就直接用；
3. 强缓存失效后，发起请求带上 `If-Modified-Since` / `If-None-Match`；
4. 服务器判断资源是否改变，没变就返回 304，否则返回新资源



### localStorage、SessionStorage、Cookie

#### localStorage

**用途**：用于在客户端长期保存数据，没有过期时间，除非手动删除。

**存储大小**：一般为 5MB 左右。

**作用域**：同源（同协议+同域名+同端口）下共享。

**过期时间**：**永不过期**，除非用户或代码清除。

```javascript
// 存储数据
localStorage.setItem("username", "Tom");

// 获取数据
let name = localStorage.getItem("username");

// 删除某项数据
localStorage.removeItem("username");

// 清空所有数据
localStorage.clear();
```



#### SessionStorage

**用途**：在同一浏览器标签页中存储临时数据。

**存储大小**：一般也是 5MB。

**作用域**：同源下，**同标签页之间不能共享**。

**过期时间**：**浏览器标签页关闭即清除**。

```javascript
// 存储数据
sessionStorage.setItem("login", "true");

// 获取数据
let loginStatus = sessionStorage.getItem("login");

// 删除或清空
sessionStorage.removeItem("login");
sessionStorage.clear();
```



#### Cookie

**用途**：早期主要用于在客户端和服务器之间传输小型数据，如用户身份验证、会话追踪。

**存储大小**：一般为 **4KB** 左右。

**作用域**：同源下共享，可跨标签页。

**过期时间**：可设置，默认是**会话级别（关闭浏览器即删除）**。

**可被服务器访问**（重要区别）。

```javascript
// 设置 cookie
document.cookie = "token=abc123; expires=Fri, 01 Jan 2030 12:00:00 GMT; path=/";

// 获取 cookie
console.log(document.cookie);

// 删除 cookie（通过设置过期时间为过去）
document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
```



#### 对比

| 特性           | `localStorage`               | `sessionStorage`             | `cookie`                         |
| -------------- | ---------------------------- | ---------------------------- | -------------------------------- |
| 存储大小       | ≈ 5MB                        | ≈ 5MB                        | ≈ 4KB                            |
| 生命周期       | 永久保存                     | 页面会话                     | 自定义/默认会话                  |
| 是否随请求发送 | ❌ 不会                       | ❌ 不会                       | ✅ 自动随请求发送                 |
| 可跨页面访问   | ✅ 同源下均可                 | ❌ 不可（仅当前标签页）       | ✅ 同源下可访问                   |
| 可由服务器访问 | ❌ 仅限客户端                 | ❌ 仅限客户端                 | ✅ 可通过 `HTTP` 访问             |
| 操作接口       | JS API（简单）               | JS API（简单）               | JS API or HTTP header            |
| 安全性         | 相对较高（不可自动传输）     | 相对较高                     | 较低（容易被劫持）               |
| 适应场景       | 保存用户长期偏好设置，如主题 | 一次性表单数据或当前会话状态 | 登录状态、需要与服务器通信的数据 |



#### 安全建议

**cookie** 要设置 `HttpOnly` 和 `Secure` 属性，提高安全性，避免 XSS、CSRF。

`localStorage` 和 `sessionStorage` 容易受到 **XSS 攻击**，不要存储敏感信息（如 token）。

推荐使用 **JWT + HttpOnly cookie** 来管理登录状态。